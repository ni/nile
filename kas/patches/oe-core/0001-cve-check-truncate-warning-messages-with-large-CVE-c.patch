From 88b95d7320ba66b36341ec3f53cba808271e12b3 Mon Sep 17 00:00:00 2001
From: Brenda Streiff <brenda.streiff@emerson.com>
Date: Tue, 20 Jan 2026 17:52:31 -0600
Subject: [PATCH] cve-check: truncate warning messages with large CVE counts

Building certain older recipes can yield very long output lines with
CVE_CHECK_SHOW_WARNINGS enabled. Linux 5.10, for example, has several
thousand CVEs. These long output lines can cause problems for tooling
that wrap build output (such as kas).

After a certain point, it becomes meaningless to output CVE IDs here;
no human will be cataloguing the several thousand CVEs in build output,
and any tooling will be using the CVE logs that are also referred to by
these lines. So, truncate these to output only the first ten CVEs with
an "and more" if necessary, so that we still print a meaningful warning
that is not entirely noise.

Signed-off-by: Brenda Streiff <brenda.streiff@emerson.com>
Upstream-Status: Pending [oe-core master has reworked this]
---
 meta/classes/cve-check.bbclass | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/meta/classes/cve-check.bbclass b/meta/classes/cve-check.bbclass
index f5bbaa5d15..91f4736770 100644
--- a/meta/classes/cve-check.bbclass
+++ b/meta/classes/cve-check.bbclass
@@ -513,7 +513,12 @@ def cve_write_data_text(d, patched, unpatched, ignored, cve_data):
         write_string += "MORE INFORMATION: %s%s\n\n" % (nvd_link, cve)
 
     if unpatched_cves and d.getVar("CVE_CHECK_SHOW_WARNINGS") == "1":
-        bb.warn("Found unpatched CVE (%s), for more information check %s" % (" ".join(unpatched_cves),cve_file))
+        if len(unpatched_cves) > 10:
+            cve_output_string = " ".join(unpatched_cves[0:10]) + (" and %d more" % (len(unpatched_cves)-10))
+        else:
+            cve_output_string = " ".join(unpatched_cves)
+
+        bb.warn("Found unpatched CVE (%s), for more information check %s" % (cve_output_string,cve_file))
 
     with open(cve_file, "w") as f:
         bb.note("Writing file %s with CVE information" % cve_file)
-- 
2.47.3

